<!DOCTYPE html>
<html>
<head>
    <title>Network Debug</title>
    <script>
        const originalFetch = window.fetch;
        const originalXHR = window.XMLHttpRequest;
        
        // æ‹¦æˆªæ‰€æœ‰fetchè¯·æ±‚
        window.fetch = function(...args) {
            console.log('ğŸŒ FETCH Request:', args[0], args[1]);
            return originalFetch.apply(this, args)
                .then(response => {
                    console.log('âœ… FETCH Response:', response.status, response.url);
                    return response;
                })
                .catch(error => {
                    console.error('âŒ FETCH Error:', error);
                    throw error;
                });
        };
        
        // æ‹¦æˆªæ‰€æœ‰XMLHttpRequest
        window.XMLHttpRequest = function() {
            const xhr = new originalXHR();
            const originalOpen = xhr.open;
            const originalSend = xhr.send;
            
            xhr.open = function(method, url) {
                console.log(`ğŸ”— XHR ${method}:`, url);
                return originalOpen.apply(this, arguments);
            };
            
            xhr.addEventListener('load', function() {
                console.log('âœ… XHR Response:', this.status, this.responseURL);
            });
            
            xhr.addEventListener('error', function() {
                console.error('âŒ XHR Error:', this);
            });
            
            return xhr;
        };
        
        // ç›‘å¬æ‰€æœ‰unhandled promise rejections
        window.addEventListener('unhandledrejection', function(event) {
            console.error('âŒ Unhandled Promise Rejection:', event.reason);
        });
    </script>
</head>
<body>
    <h1>Network Debug with AI Iframe</h1>
    
    <div id="logs" style="margin-bottom: 20px;">
        <h3>Real-time Logs:</h3>
        <div id="logContainer" style="border: 1px solid #ccc; padding: 10px; height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px;"></div>
    </div>
    
    <iframe 
        id="aiIframe"
        src="https://www.xingyunlink.com/chat/share?shareId=xs4443zwclnh7uelttdtg7z6"
        style="width: 100%; height: 500px; border: 1px solid #000;"
        allow="microphone"
    ></iframe>

    <script>
        const logContainer = document.getElementById('logContainer');
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;
        
        function addLog(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.style.color = type === 'error' ? 'red' : type === 'warn' ? 'orange' : 'black';
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        console.log = function(...args) {
            const message = args.join(' ');
            addLog('log', message);
            return originalConsoleLog.apply(console, args);
        };
        
        console.error = function(...args) {
            const message = args.join(' ');
            addLog('error', message);
            return originalConsoleError.apply(console, args);
        };
        
        const iframe = document.getElementById('aiIframe');
        
        iframe.onload = function() {
            console.log('ğŸ¯ Iframe fully loaded');
            
            // æ£€æŸ¥iframeå†…å®¹
            setTimeout(() => {
                try {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    console.log('ğŸ“„ Iframe document title:', iframeDoc?.title);
                    console.log('ğŸ“„ Iframe document readyState:', iframeDoc?.readyState);
                    console.log('ğŸ“„ Iframe body children:', iframeDoc?.body?.children?.length);
                } catch (e) {
                    console.log('âš ï¸ Cannot access iframe content due to CORS');
                }
            }, 2000);
        };
        
        iframe.onerror = function(e) {
            console.error('âŒ Iframe error:', e);
        };
        
        // Performance monitoring
        window.addEventListener('load', function() {
            setTimeout(() => {
                const perfData = performance.getEntriesByType('navigation')[0];
                console.log('ğŸ“Š Page Performance:');
                console.log(`- DNS lookup: ${perfData.domainLookupEnd - perfData.domainLookupStart}ms`);
                console.log(`- TCP connect: ${perfData.connectEnd - perfData.connectStart}ms`);
                console.log(`- Request: ${perfData.responseStart - perfData.requestStart}ms`);
                console.log(`- Response: ${perfData.responseEnd - perfData.responseStart}ms`);
                console.log(`- DOM load: ${perfData.domContentLoadedEventEnd - perfData.domContentLoadedEventStart}ms`);
                
                const resources = performance.getEntriesByType('resource');
                console.log(`ğŸ“Š Total resources loaded: ${resources.length}`);
                
                resources.forEach(resource => {
                    if (resource.name.includes('xingyunlink')) {
                        console.log(`ğŸ”— Xingyunlink resource: ${resource.name} (${resource.duration}ms)`);
                    }
                });
            }, 3000);
        });
    </script>
</body>
</html>
